<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BI Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>BI Dashboard</h1>
  <p>Data from {{ start_date }} to {{ end_date }}</p>
  <p>Total Requests: {{ total_requests }}</p>
  
  <h2>Conversion Rates (Last 30 Days)</h2>
  <ul>
  {% for key, data in conversion.items() %}
    <li>
      <strong>{{ key }}:</strong>
      Total: {{ data.total_requests }},
      Success: {{ data.successful_requests }},
      Rate: {{ data.conversion_rate | round(2) }}
    </li>
  {% endfor %}
  </ul>
  
  <canvas id="conversionChart" width="400" height="200"></canvas>
  
  <h2>User Retention (Last 30 Days)</h2>
  <p>Total Users: {{ retention.total_users }}</p>
  <p>Active Users (Last 7 Days): {{ retention.active_users }}</p>
  <p>Retention Rate: {{ retention.retention_rate | round(2) }}</p>
  
  <h2>Performance Metrics</h2>
  <ul>
  {% for key, data in performance.items() %}
    <li>
      <strong>{{ key }}:</strong>
      Avg Time: {{ data.avg_response_time | round(2) }} ms,
      Max Time: {{ data.max_response_time }} ms,
      Error Rate: {{ data.error_rate | round(2) }}
    </li>
  {% endfor %}
  </ul>
  
  <script>
    // Prepare data for conversion chart
    const labels = [{% for key in conversion.keys() %}"{{ key }}",{% endfor %}];
    const totalRequests = [{% for key, data in conversion.items() %}{{ data.total_requests }},{% endfor %}];
    const successRequests = [{% for key, data in conversion.items() %}{{ data.successful_requests }},{% endfor %}];
  
    const ctx = document.getElementById('conversionChart').getContext('2d');
    const conversionChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'Total Requests',
            data: totalRequests,
            backgroundColor: 'rgba(75, 192, 192, 0.5)'
          },
          {
            label: 'Successful Requests',
            data: successRequests,
            backgroundColor: 'rgba(153, 102, 255, 0.5)'
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
          }
        }
      }
    });
  </script>
</body>
</html>
